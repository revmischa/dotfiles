# Git configuration
{{- /* Only include [user] section if git user is already configured */ -}}
{{- $gitName := (output "sh" "-c" "git config --global user.name 2>/dev/null || true") | trim }}
{{- $gitEmail := (output "sh" "-c" "git config --global user.email 2>/dev/null || true") | trim }}

{{- if or $gitName $gitEmail }}
[user]
{{-   if $gitName }}
	name = {{ $gitName | quote }}
{{-   end }}
{{-   if $gitEmail }}
	email = {{ $gitEmail | quote }}
{{-   end }}
{{- end }}

[core]
	excludesfile = ~/.gitignore_global

[init]
	defaultBranch = main

[push]
	default = tracking
	autoSetupRemote = true

[pull]
	rebase = true

[merge]
	renamelimit = 6000
	ff = false

[branch "main"]
	rebase = true

[branch "master"]
	rebase = true

[color]
	ui = auto
	diff = auto
	status = auto
	branch = auto

[alias]
  # make main==master
  alias-master-as-main = !git symbolic-ref refs/heads/main refs/heads/master && git symbolic-ref refs/remotes/origin/main refs/remotes/origin/master && git switch main

	# Logs and history
	lg = log -p
	lol = log --graph --decorate --pretty=oneline --abbrev-commit
	lola = log --graph --decorate --pretty=oneline --abbrev-commit --all
	lo = log --graph --decorate --all --oneline --stat
	dlog = log -u HEAD~500..HEAD --

	# Branch management
	rb = ! git for-each-ref --sort=-committerdate --count=20 --format='%(authorname),%(color:bold yellow)%(refname:short)%(color:reset) (%(color:bold magenta)%(committerdate:relative)%(color:reset)) %(color:cyan)%(objectname:short)%(color:reset) - %(color:dim white)%(contents:subject)%(color:reset)' refs/heads/
	rrb = ! git for-each-ref --sort=-committerdate --count=20 --format='%(authorname),%(color:bold yellow)%(refname:short)%(color:reset) (%(color:bold magenta)%(committerdate:relative)%(color:reset)) %(color:cyan)%(objectname:short)%(color:reset) - %(color:dim white)%(contents:subject)%(color:reset)' refs/remotes/origin/

	# Push/Pull shortcuts
	pom = pull origin master
	pso = push --set-upstream origin
	pnv = push --no-verify

	# Utilities
	up = !sh -c 'git pull --rebase --prune && git log --pretty=format:\"%Cred%ae %Creset- %C(yellow)%s %Creset(%ar)\" HEAD@{1}..'
	mm = merge master -m "Merging in master"
	rbc = rebase --continue
	ls = ls-files
	tags = tag -ln
	diverges = !bash -c 'diff -u <(git rev-list --first-parent "${1}") <(git rev-list --first-parent "${2:-HEAD}") | sed -ne \"s/^ //p\" | head -1' -

[help]
	autocorrect = 3

[github]
	user = revmischa

[url "git@github.com:"]
	insteadOf = https://github.com/

[merge "npm-merge-driver"]
	name = automatically merge npm lockfiles
	driver = npx npm-merge-driver merge %A %O %B %P

[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true

[filter "media"]
	clean = git media clean %f
	smudge = git media smudge %f
	required = true
